<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link id="favicon" rel="icon" href="btc-logo.svg">
		<title>BTC Status - Monitoramento de Preço do Bitcoin</title>
		<style>
			*,
			*::before,
			*::after {
			padding: 0;
			margin: 0;
			box-sizing: border-box;
			}

			body {
			background-color: black;
			color: white;
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0px;
			text-align: center;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			height: 100vh;
			width: 100vw;
			}

			#tela-carregamento {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 1);
			display: flex;
			justify-content: center;
			align-items: center;
			font-size: 100px;
			color: #f7931a;
			z-index: 9999;
			}

			.girando {
			animation: girandosimbolo 0.3s infinite linear;
			}

			@keyframes girandosimbolo {
			0% { transform: rotate(0deg); }
			25% { transform: rotate(90deg); }
			50% { transform: rotate(180deg); }
			75% { transform: rotate(270deg); }
			100% { transform: rotate(360deg); }
			}

			.pywebview-drag-region {
			position: fixed;
			top: 0;
			height: 100%;
			}

			#overlay {
			display: none;
			position: fixed;
			top: 25px;
			left: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.7);
			color: white;
			font-size: 15rem;
			justify-content: center;
			align-items: center;
			z-index: 1000;
			text-align: center;
			flex-direction: column;
			font-family: Arial, sans-serif;
			}

			.btns {
			position: absolute;
			top: 4px;
			width: 20px;
			height: 20px;
			justify-content: center;
			font-size: larger;
			font-weight: lighter;
			}

			.btns:hover {
			color: #f7931a;
			}

			#close-btn {
			right: 0px;
			display: none;
			}

			@keyframes surgindo {
			0% {opacity: 0;}
			100% {opacity: 1;}
			}

			#info-seta {
			font-weight: bold;
			opacity: 0;
			}

			#minimize-btn {
			right: 25px;
			display: none;
			}

			#reload-btn {
			left: 25px;
			display: none;
			}

			#centralizar-btn {
			left: 0px;
			display: none;
			}

			#fixar-btn {
			left: 69px;
			display: none;
			}

			#pausar-btn {
			left: 47px;
			display: none;
			}

			#info-logo {
			color: #f7931a;
			font-weight: bold;
			margin-top: 20px;
			}

			#highPriceE,
			#lowPriceE,
			#highPriceDolE,
			#lowPriceDolE,
			#minimumFeeE,
			#economyFeeE,
			#fastestFeeE,
			#halfHourFeeE,
			#hourFeeE,
			#mediumFeeE {
			text-align: left;
			}

			#highPrice,
			#lowPrice,
			#highPriceDol,
			#lowPriceDol,
			#minimumFee,
			#economyFee,
			#fastestFee,
			#halfHourFee,
			#hourFee,
			#mediumFee {
			color: #ffffff;
			justify-content: flex-end;
			display: flex;
			}

			#taxa_topico,
			#info-time,
			#info-dolar {
			color: #646464;
			}

			#info-usdt {
			color: #b5b5b5;
			}

			#info-price {
			color: #f7931a;
			}

			.btc_em_brl_principal,
			.percentual,
			.horario_atualizacao,
			.btc_em_usdt_secundariol,
			.dolar_btc_e_b3 {
			font-weight: 100;
			color: white;
			margin-top: 0px;
			}

			.bottom-left-info,
			table {
			border-collapse: collapse;
			width: 100%;
			}

			.bottom-left-info {
			font-size: 1.5vw;
			color: white;
			width: 100%;
			}

			.bottom-left-info,
			td {
			color: #f7931a;
			margin: 2px 0;
			}

			.separator {
			border: none;
			border-top: 1px solid white;
			margin: 5px 0;
			}

			@media (min-width: 1921px) {
				#info-logo {
				font-size: 4vw;
				}

				.btc_em_brl_principal {
				font-size: 3.5vw;
				}

				.btc_em_usdt_secundariol {
				font-size: 2vw;
				}

				.dolar_btc_e_b3 {
				font-size: 0.8vw;
				}

				.percentual {
				font-size: 4vw;
				}

				.horario_atualizacao {
				font-size: 0.8vw;
				}

				.bottom-left-info,
				table {
				font-size: 0.8vw;
				}
			}

			@media (max-width: 1920px) {
				#info-logo {
				font-size: 5vw;
				}

				.btc_em_brl_principal {
				font-size: 4vw;
				}

				.btc_em_usdt_secundariol {
				font-size: 2vw;
				}

				.dolar_btc_e_b3 {
				font-size: 1.5vw;
				}

				.percentual {
				font-size: 5vw;
				}

				.horario_atualizacao {
				font-size: 1.5vw;
				}

				.bottom-left-info,
				table {
				font-size: 1.5vw;
				}
			}

			@media (max-width: 1024px) {
				#info-logo {
				font-size: 8vw;
				}

				.btc_em_brl_principal {
				font-size: 7vw;
				}

				.btc_em_usdt_secundariol {
				font-size: 4vw;
				}

				.dolar_btc_e_b3 {
				font-size: 3vw;
				}

				.percentual {
				font-size: 8vw;
				}

				.horario_atualizacao {
				font-size: 3vw;
				}

				.bottom-left-info,
				table {
				font-size: 3vw;
				}
			}

			@media (max-width: 640px) {
				#info-logo {
				font-size: 16vw;
				}

				.btc_em_brl_principal {
				font-size: 14vw;
				}

				.btc_em_usdt_secundariol {
				font-size: 8vw;
				}

				.dolar_btc_e_b3 {
				font-size: 4vw;
				}

				.percentual {
				font-size: 16vw;
				}

				.horario_atualizacao {
				font-size: 4vw;
				}

				.bottom-left-info,
				table {
				font-size: 4vw;
				}
			}
		</style>
		<script>
			let tempoInatividade = 0;
			let varSetaMostrar;
			let ativo = true;
			let falhas = 0;
			let novoIntervalo = 0;
			const maxFalhas = 10;
			// Definir tempo para atualizar iniciar em milisegundos
			const update_Time = 3000;
			// Definir tempo para atualizar taxas em milisegundos
			const update_Taxas = 60000;
			// Definir tempo máximo de inatividade em segundos
			const tempoLimite = 1000;
			// Função para resetar o tempo de inatividade
			function resetarInatividade() {
				tempoInatividade = 0;
				if (ativo) return;
				document.getElementById('overlay').style.display = 'none';
				ativo = true;
				inicial();
				atualiza_taxas();
				clearInterval(intervaloID);
				intervaloID = setInterval(inicial, update_Time);
				clearInterval(taxaIntervaloID);
				taxaIntervaloID = setInterval(atualiza_taxas, update_Taxas);
			}

			function verificarInatividade() {
				// Se já está inativo não faça nada
				if (!ativo) return;
				// Adiciona tempo de inatividade
				tempoInatividade++;
				if (tempoInatividade >= tempoLimite) {
					document.getElementById('overlay').style.display = 'flex';
					ativo = false;
					clearInterval(intervaloID);
					clearInterval(taxaIntervaloID);
				}
			}
			// Monitorando eventos de teclado
			document.addEventListener('keydown', resetarInatividade);
			// Monitorando eventos de movimento do mouse
			document.addEventListener('mousemove', resetarInatividade);

			function pyWebviewFechar() {
				window.pywebview.api.fechar();
			}

			function pyWebviewMinimize() {
				window.pywebview.api.minimizar();
			}

			function pyWebviewCentralizar() {
				window.pywebview.api.centralizar('True');
			}

			function pyWebviewFixar() {
				const btn = document.getElementById('fixar-btn');
				if (btn.textContent === '△') {
					btn.setAttribute('title', 'Desafixar');
					btn.setAttribute('alt', 'Desafixar');
					btn.textContent = '▽';
				} else {
					btn.setAttribute('title', 'Fixar');
					btn.setAttribute('alt', 'Fixar');
					btn.textContent = '△';
				}
				window.pywebview.api.fixarTopo();
			}

			function reiniciar() {
				if (document.getElementById('fixar-btn').textContent == '▽') {
					document.getElementById('fixar-btn').textContent == '△'
					window.pywebview.api.fixarTopo();
				}
				location.reload();
			}

			function pararIniciar() {
				if (ativo) {
					ativo = false;
					document.getElementById('overlay').style.display = 'flex';
					clearInterval(intervaloID);
					clearInterval(taxaIntervaloID);
					document.removeEventListener('keydown', resetarInatividade);
					document.removeEventListener('mousemove', resetarInatividade);
				} else {
					ativo = true;
					document.getElementById('overlay').style.display = 'none';
					inicial();
					clearInterval(intervaloID);
					intervaloID = setInterval(inicial, update_Time);
					atualiza_taxas();
					clearInterval(taxaIntervaloID);
					taxaIntervaloID = setInterval(atualiza_taxas, update_Taxas);
					document.addEventListener('keydown', resetarInatividade);
					document.addEventListener('mousemove', resetarInatividade);
				}
			}

			function botoesPywebview() {
				if (navigator.userAgent=="pywebview") {
					document.getElementById("reload-btn").style.display = "flex";
					document.getElementById("centralizar-btn").style.display = "flex";
					document.getElementById("fixar-btn").style.display = "flex";
					document.getElementById("minimize-btn").style.display = "flex";
					document.getElementById("close-btn").style.display = "flex";
					document.getElementById("pausar-btn").style.display = "flex";
				} else {
					document.getElementById("pausar-btn").style.left = "unset";
					document.getElementById("pausar-btn").style.right = "0px";
					document.getElementById("pausar-btn").style.display = "flex";
					document.getElementById("reload-btn").style.left = "0px";
					document.getElementById("reload-btn").style.display = "flex";
				}
			}

			async function inicial() {
				if (ativo) {
					const percentElement = document.getElementById('info-percent');
					try {
						const responseBRL = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=BTCBRL');
						const dataBRL = await responseBRL.json();
						const lastPriceBRL = parseFloat(dataBRL.lastPrice);
						const formattedPriceBRL = lastPriceBRL.toLocaleString('pt-BR', {
							style: 'currency',
							currency: 'BRL'
						});
						const priceChangePercent = parseFloat(dataBRL.priceChangePercent);
						// Calcular se houve aumento ou diminuição do preço e mostrar a seta correspondente
						if (typeof varSetaOld !== 'undefined') {
							let varSetaNew = priceChangePercent;
							if (varSetaOld > varSetaNew) {
								varSetaMostrar = "↓";
							} else if (varSetaOld < varSetaNew) {
								varSetaMostrar = "↑";
							} else {
								varSetaMostrar = varSetaMostrar;
							}
							varSetaOld = priceChangePercent;
						} else {
							varSetaOld = priceChangePercent;
							varSetaMostrar = "↑";
						}
						const formattedPercent = priceChangePercent.toFixed(2) + '% ';
						const now = new Date();
						const formattedTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
						let titleText = `${formattedPriceBRL} | ${formattedPercent}`;
						document.title = titleText;
						// Atualizar informações de máxima e mínima de preços
						document.getElementById('highPrice').textContent = parseFloat(dataBRL.highPrice).toLocaleString('pt-BR', {
							style: 'currency',
							currency: 'BRL'
						});
						document.getElementById('lowPrice').textContent = parseFloat(dataBRL.lowPrice).toLocaleString('pt-BR', {
							style: 'currency',
							currency: 'BRL'
						});
						// Atualizar preço em BRL, percentual de aumento e hora da última atualização
						document.getElementById('info-price').textContent = formattedPriceBRL;
						if (ativo) {
							document.getElementById('info-percent').textContent = formattedPercent;
							if (varSetaMostrar=='↑') {
								document.getElementById('info-seta').style.color = "#f7931a";
							} else if (varSetaMostrar=='↓') {
								document.getElementById('info-seta').style.color = "white";
							}
							// Atualiza a seta indicando a última variação depois apaga e reativa a animação
							document.getElementById('info-seta').style.opacity = '0';
							document.getElementById('info-seta').style.animation = 'none';
							document.getElementById('info-seta').offsetHeight;
							document.getElementById('info-seta').style.animation = 'surgindo 1s forwards';
							document.getElementById('info-seta').textContent = varSetaMostrar;
						}
						document.getElementById('info-time').textContent = formattedTime;
						// Atualizar preço em USD (indice BTC) e USD B3
						atualiza_USD(lastPriceBRL);
					} catch (error) {
						console.error('Erro ao buscar dados da API BTC/BRL Binance:', error);
						document.title = 'Sem Dados';
						document.getElementById('info-price').textContent = 'Sem Dados';
					}
					novoIntervalo = Math.floor(Math.random() * 3001 + 3000);
					clearInterval(intervaloID);
					intervaloID = setInterval(inicial, novoIntervalo);
				}
			}

			async function atualiza_B3(dollarExchangeRate) {
				try {
					const responseBRLx = await fetch('https://economia.awesomeapi.com.br/json/last/USD-BRL');
					const dataBRLx = await responseBRLx.json();
					const lastPriceBRLaskx = parseFloat(dataBRLx.USDBRL.ask);
					const lastPriceBRLbidx = parseFloat(dataBRLx.USDBRL.bid);
					const lastPriceBRLx = (lastPriceBRLaskx + lastPriceBRLbidx) / 2
					const formattedPriceBRLx = lastPriceBRLx.toLocaleString('pt-BR', {
						style: 'currency',
						currency: 'BRL'
					});
					document.getElementById('info-dolar').textContent = `${dollarExchangeRate} | ${formattedPriceBRLx}`;
				} catch (error) {
					console.error('Erro ao buscar dados do BRL/USDT AwesomeAPI:', error);
					document.getElementById('info-dolar').textContent = 'Sem Dados';
				}
			}

			async function atualiza_USD(lastPriceBRL) {
				try {
					const responseUSD = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT');
					const dataUSD = await responseUSD.json();
					const lastPriceUSD = parseFloat(dataUSD.lastPrice);
					const formattedPriceUSD = lastPriceUSD.toLocaleString('pt-BR', {
						style: 'currency',
						currency: 'USD'
					});
					// Atualizar preço em USDT
					document.getElementById('info-usdt').textContent = formattedPriceUSD;
					// Calcula o valor do dólar dividindo o valor do BTC em reais pelo valor em dólares
					const dollarExchangeRate = (lastPriceBRL / lastPriceUSD).toLocaleString('pt-BR', {
						style: 'currency',
						currency: 'BRL'
					});
					// Atualizar informações de máxima e mínima de preços
					document.getElementById('highPriceDol').textContent = parseFloat(dataUSD.highPrice).toLocaleString('pt-BR', {
						style: 'currency',
						currency: 'USD'
					});
					document.getElementById('lowPriceDol').textContent = parseFloat(dataUSD.lowPrice).toLocaleString('pt-BR', {
						style: 'currency',
						currency: 'USD'
					});
					// Atualizar preço em Dólar
					atualiza_B3(dollarExchangeRate)
				} catch (error) {
					console.error('Erro ao buscar dados do BTC/BRL:', error);
					document.getElementById('info-usdt').textContent = 'Sem Dados';
					document.getElementById('info-dolar').textContent = 'Sem Dados';
				}
			}

			async function atualiza_taxas() {
				if (ativo) {
					try {
						const responseFees = await fetch('https://mempool.space/api/v1/fees/recommended');
						const dataFees = await responseFees.json();
						document.getElementById('fastestFee').textContent = `${dataFees.fastestFee} sat/vB`;
						document.getElementById('halfHourFee').textContent = `${dataFees.halfHourFee} sat/vB`;
						document.getElementById('hourFee').textContent = `${dataFees.hourFee} sat/vB`;
						document.getElementById('economyFee').textContent = `${dataFees.economyFee} sat/vB`;
						document.getElementById('minimumFee').textContent = `${dataFees.minimumFee} sat/vB`;
						document.getElementById('mediumFee').textContent = `${(dataFees.minimumFee + dataFees.economyFee + dataFees.hourFee + dataFees.halfHourFee + dataFees.fastestFee) / 5} sat/vB`;
					} catch (error) {
						console.error('Erro ao buscar dados de taxas:', error);
					}
				}
			}

			window.addEventListener('load', botoesPywebview);
			window.addEventListener('load', inicial);
			window.addEventListener('load', atualiza_taxas);
			window.onload = function() {
				setTimeout(function() {
					document.getElementById('tela-carregamento').style.display = 'none';
					document.getElementById('conteudo').style.display = 'block';
				},1000);
			}
			// Inicia a atualização se não estiver pausado
			let intervaloID = setInterval(inicial, update_Time);
			// Atualizar taxas de transação
			let taxaIntervaloID = setInterval(atualiza_taxas, update_Taxas);
			// Verificando a inatividade a cada segundo
			setInterval(verificarInatividade, 1000);
		</script>
	</head>
	<body>
		<div id="conteudo" class="pywebview-drag-region">
			<div class="botao">
				<div class="btns" id="centralizar-btn" title="Centralizar" onclick="pyWebviewCentralizar()" alt="Centralizar">▣</div>
				<div class="btns" id="reload-btn" title="Atualizar" onclick="reiniciar()" alt="Atualizar">↻</div>
				<div class="btns" id="pausar-btn" title="Pausar" onclick="pararIniciar()" alt="Pausar">■</div>
				<div class="btns" id="fixar-btn" title="Fixar" onclick="pyWebviewFixar()" alt="Fixar">△</div>
				<div class="btns" id="minimize-btn" title="Minimizar" onclick="pyWebviewMinimize()" alt="Minimizar">_</div>
				<div class="btns" id="close-btn" title="Fechar" onclick="pyWebviewFechar()" alt="Fechar">x</div>
			</div>
			<div id="overlay" class="overlay" onclick="pararIniciar()">⏸</div>
			<div id="tela-carregamento" content="width=device-width, initial-scale=1.0"><div class="girando">⟳</div></div>
			<div id= "conteudoMenosBotoes" class="conteudoMenosBotoes">
				<div id="info-logo" title="Bitcoin Monitor" alt="Logo do Bitcoin">₿</div>
				<div id="info-price" class="btc_em_brl_principal" title="Preço atual do Bitcoin em Reais(BRL). Dados da Binance©."></div>
				<div id="info-usdt" class="btc_em_usdt_secundariol" title="Preço atual do Bitcoin em Dólares americanos(USDT). Dados da Binance©."></div>
				<div id="info-dolar" class="dolar_btc_e_b3" title="Preço do dólar, calculado com base no valor do Bitcoin em reais / Preço do dólar B3. Dados do AwesomeAPI©"></div>
				<div class="percentual" title="Variação percentual do preço do Bitcoin em relação ao fechamento anterior."><span id="info-percent"></span><span id="info-seta" class="aparecer"></span></div>
				<div id="info-time" class="horario_atualizacao" title="Horário da última atualização dos dados exibidos na página."></div>
				<div class="bottom-left-info">
					<table>
						<tr>
							<td colspan="2">
								<hr class="separator">
							</td>
						</tr>
						<tr title="Preço máximo do Bitcoin em Reais nas últimas 24hrs. Dados da Binance©.">
							<td id="highPriceE">Máxima:</td>
							<td id="highPrice"></td>
						</tr>
						<tr title="Preço mínimo do Bitcoin em Reais nas últimas 24hrs. Dados da Binance©.">
							<td id="lowPriceE">Mínima:</td>
							<td id="lowPrice"></td>
						</tr>
						<tr title="Preço máximo do Bitcoin em Dólares americanos(USD) nas últimas 24hrs. Dados da Binance©.">
							<td id="highPriceDolE">Max. USDT:</td>
							<td id="highPriceDol"></td>
						</tr>
						<tr title="Preço mínimo do Bitcoin em Dólares americanos(USD) nas últimas 24hrs. Dados da Binance©.">
							<td id="lowPriceDolE">Min. USDT:</td>
							<td id="lowPriceDol"></td>
						</tr>
						<tr>
							<td colspan="2">
								<hr class="separator">
							</td>
						</tr>
						<tr>
							<td id="taxa_topico" colspan="2" title="Valores pagos nas transações em Bitcoins. Atualizado a cada 1 minuto.">Taxas</td>
						</tr>
						<tr>
							<td colspan="2">
								<hr class="separator">
							</td>
						</tr>
						<tr title="Taxa mínima sugerida pela Mempool©.">
							<td id="minimumFeeE">Minima:</td>
							<td id="minimumFee"></td>
						</tr>
						<tr title="Taxa econômica sugerida pela Mempool.">
							<td id="economyFeeE">Econômica:</td>
							<td id="economyFee"></td>
						</tr>
						<tr title="Taxa mais rápida sugerida pela Mempool©.">
							<td id="fastestFeeE">Prioridade:</td>
							<td id="fastestFee"></td>
						</tr>
						<tr title="Taxa para confirmação em aproximadamente 30 minutos. Fonte Mempool©.">
							<td id="halfHourFeeE">~30 min:</td>
							<td id="halfHourFee"></td>
						</tr>
						<tr title="Taxa para confirmação em aproximadamente 1 hora. Fonte Mempool©.">
							<td id="hourFeeE">~1 hora:</td>
							<td id="hourFee"></td>
						</tr>
						<tr>
							<td colspan="2">
								<hr class="separator">
							</td>
						</tr>
						<tr title="Média de todas as taxas. Fonte Mempool©.">
							<td id="mediumFeeE">Média:</td>
							<td id="mediumFee"></td>
						</tr>
					</table>
				</div>
			</div>
		</div>
	</body>
</html>